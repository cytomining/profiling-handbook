
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>1. Introduction &#8212; Image-based Profiling Handbook</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Configure Environment for Full Profiling Pipeline" href="02-config.html" />
    <link rel="prev" title="Preface" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Image-based Profiling Handbook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Preface
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   1. Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Configuration
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="02-config.html">
   2. Configure Environment for Full Profiling Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03-setup-images.html">
   3. Setup Images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04-run-cellprofiler.html">
   4. Run each CellProfiler step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05-create-profiles.html">
   5. Create Profiles
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="06-appendix.html">
   Appendix
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/01-overview.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/cytomining/profiling-handbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        <a class="edit-button" href="https://github.com/cytomining/profiling-handbook/edit/master/01-overview.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collect-your-software">
   1.1. Collect your software
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collect-your-pipelines">
   1.2. Collect your pipelines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#determine-how-to-get-your-image-lists-to-cellprofiler">
   1.3. Determine how to get your image lists to CellProfiler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#execute-your-cellprofiler-pipelines">
   1.4. Execute your CellProfiler pipelines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-z-projection">
     1.4.1. (Optional) Z projection
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-qc">
     1.4.2. (Optional) QC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#illumination-correction">
     1.4.3. Illumination correction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-assay-development">
     1.4.4. (Optional) Assay Development
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   1.5. Analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-your-data">
   1.6. Aggregate your data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-and-manipulate-per-well-profiles">
   1.7. Create and manipulate per-well profiles.
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Introduction</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collect-your-software">
   1.1. Collect your software
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#collect-your-pipelines">
   1.2. Collect your pipelines
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#determine-how-to-get-your-image-lists-to-cellprofiler">
   1.3. Determine how to get your image lists to CellProfiler
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#execute-your-cellprofiler-pipelines">
   1.4. Execute your CellProfiler pipelines
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-z-projection">
     1.4.1. (Optional) Z projection
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-qc">
     1.4.2. (Optional) QC
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#illumination-correction">
     1.4.3. Illumination correction
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optional-assay-development">
     1.4.4. (Optional) Assay Development
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   1.5. Analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aggregate-your-data">
   1.6. Aggregate your data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-and-manipulate-per-well-profiles">
   1.7. Create and manipulate per-well profiles.
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="introduction">
<h1><span class="section-number">1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>This handbook describes the process of running a Cell Painting experiment. While the code here will describe doing so in the context of running <a class="reference external" href="https://github.com/CellProfiler/Distributed-CellProfiler">Distributed-CellProfiler</a> on AWS on images generated by a PerkinElmer microscope, then collating the data with <a class="reference external" href="https://github.com/cytomining/cytominer-database">cytominer-database</a> and analyzing it with <a class="reference external" href="https://github.com/cytomining/pycytominer">pycytominer</a>, the basic procedure for running a Cell Painting experiment is the same no matter the microscope or the processing platform.</p>
<p>Briefly, the steps for any and every platform are:</p>
<div class="section" id="collect-your-software">
<h2><span class="section-number">1.1. </span>Collect your software<a class="headerlink" href="#collect-your-software" title="Permalink to this headline">¶</a></h2>
<p>For the specific use case here, this involves:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/CellProfiler/Distributed-CellProfiler">Distributed-CellProfiler</a></p></li>
<li><p><a class="reference external" href="https://github.com/broadinstitute/pe2loaddata">pe2loaddata</a></p></li>
<li><p><a class="reference external" href="https://github.com/cytomining/cytominer-database">cytominer-database</a></p></li>
<li><p><a class="reference external" href="https://github.com/cytomining/pycytominer">pycytominer</a></p></li>
</ul>
<p>along with their dependencies. Almost certainly, you will need a locally-to-your-images installed version of GUI CellProfiler that matches the version you want to run on your cluster - locally might mean on a local machine or a VM.</p>
</div>
<div class="section" id="collect-your-pipelines">
<h2><span class="section-number">1.2. </span>Collect your pipelines<a class="headerlink" href="#collect-your-pipelines" title="Permalink to this headline">¶</a></h2>
<p>You will minimally require these pipelines:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">illum</span></code> (illumination correction)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">analysis</span></code> (segmentation and feature extraction)</p></li>
</ul>
<p>But you may also want pipelines for:</p>
<ul class="simple">
<li><p>Z projection</p></li>
<li><p>QC</p></li>
<li><p>assay development</p></li>
</ul>
</div>
<div class="section" id="determine-how-to-get-your-image-lists-to-cellprofiler">
<h2><span class="section-number">1.3. </span>Determine how to get your image lists to CellProfiler<a class="headerlink" href="#determine-how-to-get-your-image-lists-to-cellprofiler" title="Permalink to this headline">¶</a></h2>
<p>CellProfiler needs to understand image sets, aka for each field-of-view that was captured how many channels were there, what would you like to name the channels were there, and what are the file names corresponding to each channel.
If you are using a Phenix Opera or Operetta, you can use the <code class="docutils literal notranslate"><span class="pre">pe2loaddata</span></code> program to generate a CSV that contains a list of image sets in an automated fashion, which can be passed to CellProfiler in via the LoadData module.
Otherwise, you have a couple of different options:</p>
<ol class="simple">
<li><p>You can create a similar CSV using a script that you write yourself that handles the files from your microscope and makes a similar CSV. Minimally, you need a <code class="docutils literal notranslate"><span class="pre">FileName</span></code> and <code class="docutils literal notranslate"><span class="pre">PathName</span></code> column for each channel (ie <code class="docutils literal notranslate"><span class="pre">FileName_OrigDNA</span></code>), and Metadata columns for each piece of metadata CellProfiler needs (ie <code class="docutils literal notranslate"><span class="pre">Metadata_Plate</span></code>, <code class="docutils literal notranslate"><span class="pre">Metadata_Well</span></code>, and <code class="docutils literal notranslate"><span class="pre">Metadata_Site</span></code>)</p></li>
<li><p>You can use a local copy of the files CellProfiler will be running, configure the 4 input modules of CellProfiler to create your image sets, then export CSVs using CellProfiler’s “Export Image Set Listing” option, and feed those into the pipelines to be run on your cluster.</p></li>
<li><p>Alter all of your pipelines to, rather than the LoadData CSV module, use the 4 input modules of CellProfiler and add, configure, and run each pipeline with the CreateBatchFiles module and use batch files in your cluster environment.</p></li>
</ol>
<p>These options are ordered in terms of most-scripting-proficiency-needed to least-scripting-proficiency-needed as well as least-CellProfiler-proficiency-needed to most-CellProfiler-proficiency-needed.</p>
</div>
<div class="section" id="execute-your-cellprofiler-pipelines">
<h2><span class="section-number">1.4. </span>Execute your CellProfiler pipelines<a class="headerlink" href="#execute-your-cellprofiler-pipelines" title="Permalink to this headline">¶</a></h2>
<div class="section" id="optional-z-projection">
<h3><span class="section-number">1.4.1. </span>(Optional) Z projection<a class="headerlink" href="#optional-z-projection" title="Permalink to this headline">¶</a></h3>
<p>If your images were taken with multiple planes, you will need to Z-project them. All subsequent steps should be run on the projected images.</p>
</div>
<div class="section" id="optional-qc">
<h3><span class="section-number">1.4.2. </span>(Optional) QC<a class="headerlink" href="#optional-qc" title="Permalink to this headline">¶</a></h3>
<p>You may want to run a quality control pipeline to determine your imaging plate quality. You can choose to run this locally or on your cluster compute environment. You will need to evaluate the results of this pipeline somehow, in CellProfiler-Analyst, KNIME, SpotFire, etc. You may run illumination correction and assay development steps in the meantime, but should hold analysis steps until the results are evaluated.</p>
</div>
<div class="section" id="illumination-correction">
<h3><span class="section-number">1.4.3. </span>Illumination correction<a class="headerlink" href="#illumination-correction" title="Permalink to this headline">¶</a></h3>
<p>You need to run a pipeline that is grouped by plate and creates an illumination correction function. Since it is grouped by plate, you don’t need very many CPUs to run this, but it will take 6-24 hours depending on settings and image size. Assay development and analysis require this step to complete.</p>
</div>
<div class="section" id="optional-assay-development">
<h3><span class="section-number">1.4.4. </span>(Optional) Assay Development<a class="headerlink" href="#optional-assay-development" title="Permalink to this headline">¶</a></h3>
<p>If desired, you can run a pipeline that executes on one image per well and carries out your segmentation but not measurement steps and makes (an) image(s) that you can use to evaluate the quality of the segmentation (either individually or by stitching them together first). This is not required but allows you to ensure that your segmentation parameters look reasonable across the variety of phenotypes present in your data.</p>
<p>If being run, the final step should be held until this step can be evaluated.</p>
</div>
</div>
<div class="section" id="analysis">
<h2><span class="section-number">1.5. </span>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">¶</a></h2>
<p>This pipeline segments the cells and measures the whole images and cells, and creates output CSVs (or can dump to a MySQL host if configured). This is typically run on each image site in parallel and thus can be sped up by using a large number of CPUs.</p>
</div>
<div class="section" id="aggregate-your-data">
<h2><span class="section-number">1.6. </span>Aggregate your data<a class="headerlink" href="#aggregate-your-data" title="Permalink to this headline">¶</a></h2>
<p>Since the analysis is run in parallel, unless using a MySQL host you will have a number of sets of CSVs that need to be turned into a single file per plate. This is currently done with the <code class="docutils literal notranslate"><span class="pre">cytominer-database</span></code> program.</p>
</div>
<div class="section" id="create-and-manipulate-per-well-profiles">
<h2><span class="section-number">1.7. </span>Create and manipulate per-well profiles.<a class="headerlink" href="#create-and-manipulate-per-well-profiles" title="Permalink to this headline">¶</a></h2>
<p>The final step is to create per-well profiles, annotate them with metadata, and do steps such as plate normalization and feature selection. These are accomplished via a “profiling recipe” using <code class="docutils literal notranslate"><span class="pre">pycytominer</span></code>.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Preface</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="02-config.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Configure Environment for Full Profiling Pipeline</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Beth Cimini, Tim Becker, Shantanu Singh, Gregory Way, Hamdah Abbasi, Callum Tromans-Coia<br/>
    
        &copy; Copyright .<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>